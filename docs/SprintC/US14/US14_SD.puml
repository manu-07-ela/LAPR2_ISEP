@startuml
autonumber
'hide footbox
actor "Specialist Doctor" as Doctor

participant ": CreateMedicalReportUI" as UI
participant ": CreateMedicalReportController" as CTRL
participant ": Company" as Comp
participant "testStore:\nTestStore" as TS
participant ": TestMapper" as MAPPER
participant "testHasSamplesAnalyzedList: \nList<Test>" as List
participant "testHasSamplesAnalyzedListDto :\nList<TestDto> " as TDto
participant "dto: TestDto" as TDto
participant "test:Test" as TEST
participant "md: MedicalReport" as REPORT

activate Doctor
Doctor -> UI : Initiates the process of elaborate a medical report.
activate UI
UI -> CTRL : testHasSamplesAnalyzedListDto = getTestHasSamplesAnalyzedList()
activate CTRL
CTRL -> Comp : testStore = getTestStore()
activate Comp
deactivate Comp
CTRL -> TS : testHasSamplesAnalyzedList = getTestHasSamplesAnalyzedList()
activate TS
deactivate TS
CTRL -> MAPPER : toDto(testHasSamplesAnalyzedList)
activate MAPPER
ref over MAPPER
SD_TestMapper_toDto_List
end ref
MAPPER --> CTRL : testHasSamplesAnalyzedListDto
deactivate MAPPER
CTRL --> UI : testHasSamplesAnalyzedListDto
deactivate CTRL
UI --> Doctor : Shows the tests that are waiting for the \n medical report and asks to select one.
deactivate UI

Doctor -> UI :  Select the desired test.
activate UI
UI -> CTRL : testParameterListDto = getTestParameterList()
activate CTRL
CTRL -> TS : test = getTestByInternalCode(code)
activate TS
deactivate TS
CTRL -> TEST : testParameterList = getParametersResulList()
activate TEST
deactivate TEST
CTRL -> MAPPER : toDto(testParameterList)
activate MAPPER
ref over MAPPER
SD_TestParameterMapper_toDto_List
end ref
MAPPER --> CTRL : testParameterListDto
deactivate MAPPER
CTRL --> UI : testParameterListDto
deactivate CTRL
UI --> Doctor : Shows the parameter results and request the medical report.
deactivate UI

Doctor-> UI : Introduces the medical report.
activate UI

UI --> Doctor : Displays the data and requests confirmation.
deactivate UI

Doctor-> UI : Confirms the data.
activate UI
UI -> CTRL: createMedicalReport()
activate CTRL
CTRL -> TEST : md = createMedicalReport(report)
activate TEST
TEST --> REPORT** : create(report)
deactivate TEST
CTRL --> UI : result
deactivate CTRL
UI --> Doctor : Informs operation success.
deactivate UI

deactivate Doctor



@enduml