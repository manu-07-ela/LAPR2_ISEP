@startuml
'https://plantuml.com/sequence-diagram

autonumber

actor "Administrator" as ADM

participant ": ValidateWorkUI" as UI
participant ": ValidateWorkController" as CTRL
participant ": Company" as COMP
participant "testStore: TestStore" as TSTORE
participant ": TestMapper" as TMAPPER
participant "listTestWaitingForResult: \nList<Test>" as LWFR
participant "listTestsToValidateDto: \nList<TestDto>" as LISTTWFV
participant "listDatesDto: \nList<TestDto>" as LISTDDTO
participant "test : Test" as TEST
participant ": LabCoordinatorValidation" as LCV
participant "testDto : TestDTO" as TESTDTO
participant ": DateMapper" as DMAPPER
participant "registrationDateDTO : \nRegistrationDateDTO" as RDDTO
participant "chemicalAnalysisDateDTO : \nChemicalAnalysisDateDTO" as CADDTO
participant "diagnosisDateDto : \nDiagnosisDateDto" as DDDTO
participant ": EmailNotification" as EMAILNOTF
participant ": SMSNotification" as SMSNOTF

autonumber

activate ADM
ADM -> UI : starts validation
activate UI
UI -> CTRL : getTestsToValidateList()
activate CTRL
CTRL -> COMP : testStore = getTestStore
activate COMP
deactivate COMP
CTRL -> TSTORE : testHasReportList = getTestHasReportList()
activate TSTORE
deactivate TSTORE
CTRL -> TMAPPER : toDto(testHasReportList)
activate TMAPPER
TMAPPER --> LISTTWFV** : create()
loop for each object in listTestWaitingForResult
TMAPPER -> LWFR : testAux = get(i)
activate LWFR
deactivate LWFR
TMAPPER -> TEST : testDescription  = getDescription()
activate TEST
deactivate TEST
TMAPPER -> TEST : testInternalCode = getInternalCode()
activate TEST
deactivate TEST
TMAPPER --> TESTDTO** : create(nhsCode, testCode)
TMAPPER -> LISTTWFV : add(testDto)
activate LISTTWFV
deactivate LISTTWFV
end
TMAPPER --> CTRL : listTestsToValidateDto
deactivate TMAPPER
CTRL --> UI : listTestsToValidateDto
deactivate CTRL
UI --> ADM : shows the tests to validate
deactivate UI






ADM -> UI:select a tests to validate (selectedTestDto)
activate UI
UI -> CTRL : createTestValidation()
activate CTRL
CTRL -> TEST : validateWork()
activate TEST
TEST -> LCV : create()
activate LCV
deactivate LCV
deactivate TEST
deactivate CTRL

UI -> CTRL : showRegistrationDate()
activate CTRL
CTRL -> TEST : date = getTestAddDate()
activate TEST
deactivate TEST
CTRL -> DMAPPER : dateDto = toDto(date)
activate DMAPPER
deactivate DMAPPER
CTRL --> UI : dateDto
deactivate CTRL
UI --> ADM : shows the test registration \n date and asks for validation
deactivate UI






ADM -> UI: validate date
activate UI
UI -> CTRL : registrationDateValidated()
activate CTRL
CTRL -> LCV : registrationDateValidated()
activate LCV
deactivate LCV
deactivate CTRL

UI -> CTRL : showChemicalAnalysisDate()
activate CTRL
CTRL -> TEST : date = getTestAddDate()
activate TEST
deactivate TEST
CTRL -> DMAPPER : dateDto = toDto(date)
activate DMAPPER
deactivate DMAPPER
CTRL --> UI : dateDto
deactivate CTRL
UI --> ADM : shows the chemical analysis \n date and asks for validation
deactivate UI






ADM -> UI: validate date
activate UI
UI -> CTRL : chemicalAnalysisDateValidated()
activate CTRL
CTRL -> LCV : chemicalAnalysisDateValidated()
activate LCV
deactivate LCV
deactivate CTRL
UI -> CTRL : showDiagnosisDate()
activate CTRL
CTRL -> TEST : date = getTestAddDate()
activate TEST
deactivate TEST
CTRL -> DMAPPER : dateDto = toDto(date)
activate DMAPPER
deactivate DMAPPER
CTRL --> UI : dateDto
deactivate CTRL
UI --> ADM : shows the diagnosis \n date and asks for validation
deactivate UI





ADM -> UI: validate date
activate UI
UI -> CTRL : diagnosisDateValidated()
activate CTRL
CTRL -> LCV : diagnosisDateValidated()
activate LCV
deactivate LCV
deactivate CTRL
UI -> CTRL : showDates()
activate CTRL
CTRL -> LISTDDTO : registrationDate = getRegistrationDate()
activate LISTDDTO
deactivate LISTDDTO
CTRL -> LISTDDTO : chemicalAnalysisDate = getChemicalAnalysisDate()
activate LISTDDTO
deactivate LISTDDTO
CTRL -> LISTDDTO : diagnosisDate = getDiagnosisDate()
activate LISTDDTO
deactivate LISTDDTO
CTRL --> UI : showDates (registrationDate,chemicalAnalysisDate,diagnosisDate)
deactivate CTRL
UI --> ADM : shows the dates (test registration, \n chemical analysis and diagnosis)
deactivate UI






ADM -> UI: confirms the validation
activate UI
UI -> CTRL : recordValidationDate()
activate CTRL
CTRL -> TEST : validationDate = generateDataAndTimeLabCoordinatorValidation()
activate TEST
TEST -> LCV : recordLabCoordinatorValidationDate()
activate LCV

deactivate LCV
deactivate TEST
deactivate CTRL
UI -> CTRL : notifyTheClient(Client)
activate CTRL
CTRL -> EMAILNOTF : notification(selectedTest)
activate EMAILNOTF
deactivate EMAILNOTF
CTRL -> SMSNOTF : notification(selectedTest)
activate SMSNOTF
deactivate SMSNOTF
deactivate CTRL
UI --> ADM : informs the operation success
deactivate UI
deactivate ADM



@enduml