<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="pt"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>Test.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Sem2App</a> &gt; <a href="index.source.html" class="el_package">app.domain.model.testrelated</a> &gt; <span class="el_source">Test.java</span></div><h1>Test.java</h1><pre class="source lang-java linenums">package app.domain.model.testrelated;


import app.domain.model.attributes.NhsCode;
import app.domain.model.laboratories.ClinicalAnalysisLaboratory;
import app.domain.model.users.Client;

import java.io.Serializable;
import java.util.ArrayList;
import java.util.Calendar;
import java.util.Date;
import java.util.List;

public class Test implements Serializable {
    /**
     * Represents the states of a test
     */
<span class="fc" id="L18">    public static enum StateOfTest {</span>
<span class="fc" id="L19">        TestRegistered, SamplesCollected, SamplesAnalyzed,</span>
<span class="fc" id="L20">        DiagnosisMade, Validated</span>
    }

    /**
     * Client's National Healthcare Service code
     */
    private NhsCode nhscode;
    /**
     * A list of TestParameters
     */
    private List&lt;TestParameter&gt; testParameterList;
    /**
     * Represents the test type associated with the test
     */
    private TestType testType;

    /**
     * The samples associated with a test
     */
    private List&lt;Sample&gt; samples;
    /**
     * Indicates the state in which the test is
     */
    private StateOfTest stateOfTest;
    /**
     * Represents the client associated with the test
     */
    private Client client;

    /**
     * Represents the internal code of a test
     */
    private String internalCode;

    /**
     * Represents the description of a test
     */
    private String description;
    /**
     * Represents the date when the samples were added to the test
     */
    private Date samplesAddDate;

    /**
     * Represents the date when the test was registered
     */
    private Date testAddDate;

    /**
     * Represents the date when the chemical analysis were added to the test
     */
    private Date chemicalAnalysisDate;

    /**
     * The Test Parameter Result of the test.
     */
    private TestParameterResult tpr;

    /**
     * The medical report of the test.
     */
    private MedicalReport md;
    /**
     * The lab coordinator validation of the test.
     */
    private LabCoordinatorValidation lcv;
    /**
     * It counts how many times it was added a result in a test
     */
    private static int countAddResult;
    /**
     * Represents an instance of Laboratory
     */
    private ClinicalAnalysisLaboratory lab;

    /**
     * Constructs an instance of {@code Test} receiving the client, National Healthcare Service code, test type, test parameter list , Clinical Analysis Laboratory and internal code by parameter
     * @param cl a client
     * @param nhscode the National Healthcare Service code
     * @param testType the test type
     * @param testParameterList the Test Parameter List
     * @param lab the Clinical Analysis Laboratory
     * @param internalCode the Internal code
     */
<span class="fc" id="L104">    public Test(Client cl, NhsCode nhscode, TestType testType, List&lt;TestParameter&gt; testParameterList,ClinicalAnalysisLaboratory lab,String internalCode) {</span>
<span class="fc" id="L105">        this.client = cl;</span>
<span class="fc" id="L106">        this.nhscode = new NhsCode(nhscode);</span>
<span class="fc" id="L107">        this.testType = testType;</span>
<span class="fc" id="L108">        this.testParameterList = testParameterList;</span>
<span class="fc" id="L109">        this.stateOfTest = StateOfTest.TestRegistered;</span>
<span class="fc" id="L110">        this.internalCode = internalCode;</span>
<span class="fc" id="L111">        this.testAddDate = Calendar.getInstance().getTime();</span>
<span class="fc" id="L112">        this.description = testType.getCollectingMethod();</span>
<span class="fc" id="L113">        this.lab = lab;</span>
<span class="fc" id="L114">        this.md = null;</span>
<span class="fc" id="L115">        this.samples = new ArrayList&lt;&gt;();</span>
<span class="fc" id="L116">        this.lcv = null;</span>
<span class="fc" id="L117">    }</span>


    /**
     * Change the status of a test for Samples collected
     */
    private void changeStateForSamplesCollected() {
<span class="nc" id="L124">        this.stateOfTest = StateOfTest.SamplesCollected;</span>
<span class="nc" id="L125">    }</span>

    /**
     * Get the state of a test
     *
     * @return the state of the test
     */
    public StateOfTest getStateOfTest() {
<span class="nc" id="L133">        return stateOfTest;</span>
    }

    /**
     * Get the client associated with a test
     * @return the client
     */
    public Client getCl() {
<span class="nc" id="L141">        return client;</span>
    }

    /**
     * Get the NHS code associated with a test
     * @return the nhs code
     */
    public NhsCode getNhsCode() {
<span class="nc" id="L149">        return nhscode;</span>
    }

    /**
     * Get the internal code associated with a test
     * @return the internal code
     */
    public String getInternalCode() {
<span class="fc" id="L157">        return internalCode;</span>
    }

    /**
     * Get the test type associated with the test
     * @return the test type
     */
    public TestType getTestType() {
<span class="nc" id="L165">        return testType;</span>
    }

    /**
     * Get the list of parameters associated with the test
     * @return the list of parameter associated with the test
     */
    public List&lt;TestParameter&gt; getTestParameterList() {
<span class="fc" id="L173">        return testParameterList;</span>
    }

    /**
     * Get the description of a test
     * @return the description
     */
    public String getDescription() {
<span class="fc" id="L181">        return description;</span>
    }

    /**
     * @return
     */
    public List&lt;Date&gt; getChemicalAnalysisDate() {
<span class="nc" id="L188">        List&lt;Date&gt; chemicalAnalysisDates = new ArrayList&lt;&gt;();</span>
<span class="nc bnc" id="L189" title="All 2 branches missed.">        for (TestParameter tp : testParameterList){</span>
<span class="nc" id="L190">            chemicalAnalysisDates.add(tp.getParamResult().getChemicalAnalysisDate());</span>
<span class="nc" id="L191">        }</span>
<span class="nc" id="L192">        return chemicalAnalysisDates;</span>
    }

    /**
     * Get the medical report associated with the test
     * @return the medical report
     */
<span class="nc" id="L199">    public MedicalReport getMedicalReport() { return this.md;}</span>

    /**
     * Get the date of the creation of medical report
     * @return the date associated with te creation of medical report
     */
<span class="nc" id="L205">    public Date getCreatedAt() { return getMedicalReport().getCreatedAt();}</span>

    /**
     * Get the laboratory associated with the test
     * @return the laboratory associated with the test
     */
    public ClinicalAnalysisLaboratory getLab() {
<span class="nc" id="L212">        return lab;</span>
    }

    /**
     * Get the list of samples associated with a test
     * @return the list of samples associated with a test
     */

<span class="nc" id="L220">    public Date getLabValidationDate() { return lcv.getLabCoordDate();}</span>


<span class="nc" id="L223">    public List&lt;Sample&gt; getSamples() { return samples; }</span>

    /**
     * Takes the test creation date
     * @return the date of creation of the test
     */
    public Date getTestAddDate() {
<span class="nc" id="L230">        return testAddDate;</span>
    }

    /**
     * Takes the test creation date
     * @return the date of creation of the test
     */
    public Date getSamplesAddDate() {
<span class="nc" id="L238">        return samplesAddDate;</span>
    }

    /**
     * Compare the test with the other object provided.
     * @param other Object we want to compare with the employee.
     * @return true if the received object represents another test equivalent to the test. Otherwise, it returns false.
     */
    @Override
    public boolean equals(Object other) {
<span class="pc bpc" id="L248" title="1 of 2 branches missed.">        if (this == other) return true;</span>
<span class="nc bnc" id="L249" title="All 4 branches missed.">        if (other == null || getClass() != other.getClass()) return false;</span>
<span class="nc" id="L250">        Test test = (Test) other;</span>
<span class="nc bnc" id="L251" title="All 6 branches missed.">        return this.getCl().equals(test.getCl()) &amp;&amp; this.getTestType().equals(test.getTestType()) &amp;&amp; this.getTestParameterList().toString().equals(test.getTestParameterList().toString());</span>
    }

    /**
     * It adds the result of a TestParameter
     * @param parameterID The code of the parameter
     * @param result the result of the TestParameter
     * @param metric the metric of the result
     */
    public boolean addTestResult(String  parameterID, String result, String metric) throws IllegalAccessException, InstantiationException, ClassNotFoundException {
<span class="fc" id="L261">        boolean verificacao=false;</span>
<span class="fc bfc" id="L262" title="All 2 branches covered.">        for (TestParameter testParameter: testParameterList) {</span>
<span class="fc bfc" id="L263" title="All 2 branches covered.">            if (testParameter.getParameterId().equals(parameterID)){</span>
<span class="fc" id="L264">                    verificacao =  testParameter.addResult(testType.getExternalModule().getRefValue(testParameter.getParameterId()) ,result,metric);</span>
<span class="pc bpc" id="L265" title="1 of 2 branches missed.">                if (!verificacao){</span>
<span class="nc" id="L266">                    return false;</span>
                }
<span class="fc" id="L268">                countAddResult++;</span>
            }
<span class="fc" id="L270">        }</span>
<span class="fc bfc" id="L271" title="All 2 branches covered.">        if (countAddResult==testParameterList.size()){</span>
<span class="fc" id="L272">            stateOfTest = StateOfTest.SamplesAnalyzed;</span>
<span class="fc" id="L273">            countAddResult=0;</span>
        }
<span class="fc" id="L275">        return verificacao;</span>

    }

    /**
     * Adds the medical report to the test.
     * @param diagnosis The diagnosis made by the specialist doctor.
     * @return true if the medical report was added. Otherwise, false.
     */
    public boolean addMedicalReport(String diagnosis) {
<span class="fc bfc" id="L285" title="All 2 branches covered.">        if (validateMedicalReport()) {</span>
<span class="fc" id="L286">            this.md = new MedicalReport(diagnosis);</span>
<span class="fc" id="L287">            this.stateOfTest = StateOfTest.DiagnosisMade;</span>
<span class="fc" id="L288">            return true;</span>
        }
<span class="fc" id="L290">        return false;</span>
    }

    /**
     * Creates a Lab Coordinator Validation.
     * @return true if the Lab Coordinator Validation was added. Otherwise, false.
     * @return
     */
    public boolean validateWork() {
<span class="fc bfc" id="L299" title="All 2 branches covered.">        if (validateLabCoordinatorValidation()) {</span>
<span class="fc" id="L300">            this.lcv = new LabCoordinatorValidation();</span>
<span class="fc" id="L301">            return true;</span>
        }
<span class="fc" id="L303">        return false;</span>
    }
    /**
     * Global validation of a lab coordinator validation.
     * @return false if the lab coordinator validation already exists. Otherwise, it returns true.
     */
    public boolean validateLabCoordinatorValidation() {
<span class="fc bfc" id="L310" title="All 2 branches covered.">        if (this.lcv != null) {</span>
<span class="fc" id="L311">            return false;</span>
        }
<span class="fc" id="L313">        return true;</span>
    }

    /**
     * Validates Date Validation
     * @return true if the Lab Coordinator Validation was added. Otherwise, false.
     *
     */
    public boolean validateDate(String date) {
<span class="nc bnc" id="L322" title="All 2 branches missed.">        if (date.equals(&quot;Registration Date&quot;)) {</span>
<span class="nc" id="L323">            lcv.checkDate(&quot;Registration Date&quot;);</span>
<span class="nc" id="L324">            return true;</span>
<span class="nc bnc" id="L325" title="All 2 branches missed.">        } else if (date.equals(&quot;Chemical Analysis Date&quot;)) {</span>
<span class="nc" id="L326">            lcv.checkDate(&quot;Chemical Analysis Date&quot;);</span>
<span class="nc" id="L327">            return true;</span>
<span class="nc bnc" id="L328" title="All 2 branches missed.">        } else if (date.equals(&quot;Diagnosis Date&quot;)) {</span>
<span class="nc" id="L329">            lcv.checkDate(&quot;Diagnosis Date&quot;);</span>
<span class="nc" id="L330">            return true;</span>
        }
<span class="nc" id="L332">        return false;</span>
    }

    /**
     * Adds the samples to the test
     * @param sample the sample that will be added to the test
     * @return true, if the copy of the sample list passed by parameter is successful, false otherwise
     */
    public void addSamples(Sample sample){
<span class="nc" id="L341">        this.samples.add(sample);</span>
<span class="nc bnc" id="L342" title="All 2 branches missed.">        if (!this.samples.isEmpty()) {</span>
<span class="nc" id="L343">            changeStateForSamplesCollected();</span>
<span class="nc" id="L344">            generateDataAndTimeForSamplesCollected();</span>
        }

<span class="nc" id="L347">    }</span>

    /**
     * Generates the date and time when the samples were associated with a test
     */
    private void generateDataAndTimeForSamplesCollected(){
<span class="nc" id="L353">        this.samplesAddDate = Calendar.getInstance().getTime();</span>
<span class="nc" id="L354">    }</span>
    /**
     * Global validation of a medical report.
     * @return false if the medical report already exists. Otherwise, it returns true.
     */
    public boolean validateMedicalReport() {
<span class="fc bfc" id="L360" title="All 2 branches covered.">        if (this.md != null) {</span>
<span class="fc" id="L361">            return false;</span>
        }
<span class="fc" id="L363">        return true;</span>
    }

    /**
     * Generates the date and time when the Lab Coordinator Validation is made.
     */
    public boolean generateDataAndTimeLabCoordinatorValidation(){
<span class="nc" id="L370">        this.stateOfTest = Test.StateOfTest.Validated;</span>
<span class="nc" id="L371">        return lcv.recordDate();</span>
    }


    /**
     * Textual description of a test
     * @return Information that characterizes a test
     */

    @Override
    public String toString() {
<span class="nc" id="L382">        return &quot;Test{&quot; +</span>
                &quot;nhscode=&quot; + nhscode +
                &quot;, testParameterList=&quot; + testParameterList +
                &quot;, testType=&quot; + testType +
                &quot;, samples=&quot; + samples +
                &quot;, stateOfTest=&quot; + stateOfTest +
                &quot;, client=&quot; + client +
                &quot;, internalCode='&quot; + internalCode + '\'' +
                &quot;, description='&quot; + description + '\'' +
                &quot;, samplesAddDate=&quot; + samplesAddDate +
                &quot;, registerTestDate=&quot; + testAddDate +
                &quot;, chemicalAnalysisDate=&quot; + chemicalAnalysisDate +
                &quot;, tpr=&quot; + tpr +
                &quot;, md=&quot; + md +
                &quot;, lcv=&quot; + lcv +
                '}';
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.2.201808211720</span></div></body></html>